- # For additional JS:
- additional_javascript('outings')
- additional_stylesheet('outings')

= render 'outing_header', outing: @outing, nav: true

#outing-body.pt-3.overline.mb-5
  -# params position is used because javascript is used to switch between who, when and where views
  #content-who-and-when.d-flex{:class => (!(params[:position] == 'where') || params[:position].nil?) ? '' : 'd-none'}
    #content-who.d-lg-block{:class => ((params[:position] == 'who')  || params[:position].nil?) ?  '' : 'd-none'}
      %p.grey #{@outing.participants.count} people interested

      = form_tag users_path, id: 'friend-search-form', class: 'mb-2', method: :get do
        = text_field_tag :search

        %button.btn.btn-outline-secondary{:type => "submit"}
          %i.bi-search

      #outing-share.d-flex.justify-content-end.align-items-center.mb-2
        Share to...
        .dropdown.ms-2
          %a.btn.btn-outline-primary.dropdown-toggle{:href => "#", "role" => "button", "data-bs-toggle" => "dropdown", "data-target" => "#"}
            %i.bi-share
            %b.caret
          %ol.lg-icon.dropdown-menu.p-3.ms-2.text-center{"role" => "menu"}
            %li
              %a{:href => "#link1"}
                %i.bi-link
            %li
              %a{:href => "#link1"}
                %i.bi-instagram
            %li
              %a{:href => "#link2"}
                %i.bi-facebook
            %li
              %a{:href => "#link3"}
                %i.bi-twitter
            %li

      #participant-cards
        - @outing.participants.each do |participant|
          = render 'outings/participant_card', participant: participant, action_buttons: true

      %hr
      = form_tag send_invites_outing_path(@outing), method: :post, remote: true do
        .d-flex.justify-content-end
          = submit_tag 'Send Invites', class: 'mb-2 btn btn-primary', id: 'send-invite-button'
        #not_invited_friends
          - current_user.not_invited_friends(@outing).each do |friend|
            = render 'invite_friend', friend: friend

    #content-when.d-lg-block{:class => ((params[:position] == 'when')) ? '' : 'd-none'}
      =render :partial => 'simple_calendar/outing_availability_calendar', :locals => {:peoples_availabilities => @peoples_availabilities}
      .d-lg-flex.justify-content-end.d-none
        %a.btn.btn-primary#set-events{:href => set_details_outing_path(@outing, position: 'where')}
          Set Events
          %i.bi-chevron-right

  #content-where.flex-lg-row.flex-column.d-flex{:class => (!(params[:position] == 'where') || params[:position].nil?) ? 'd-none' : ''}
    #where-sidebar

      = form_tag events_path, id: 'event-search-form', class: 'mb-2', method: :get do
        = text_field_tag :description

        %button.btn.btn-outline-secondary{:type => "submit"}
          %i.bi-search

      #recommended-events
        = render 'events/recommended_events', recommended_events: current_user.recommended_events(outing: @outing)

    #where-body
      %h2
        Timetable
      #where-timetable.py-1
        = render 'outings/where_timetable'



        %h2.text-center
          - if current_user.postcode?
            Nearby Hotel & Restaurant Recommendations
          - else
            Hotel & Restaurant Recommendations

        .horizontal-scroll.justify-content-center
          - if @final_events.any?
            - @final_events.each do |event|
              = render 'events/event_card_small', event: event, render_params: { add_event_to_outing: true }, outing: @outing
          - else
            %p.text-center
              No nearby restaurants or accommodation found

      .d-none.d-lg-flex.justify-content-end
        = link_to set_details_outing_path(@outing, position: 'who'), class: 'btn btn-secondary me-2' do
          %i.bi-chevron-left
          Add Participants

        = link_to 'Done', outing_path(@outing), id: 'outing-footer-done',  class: 'btn btn-primary'


%footer#outing-footer.d-lg-none.p-3
  - current_position_index = params[:position].nil? ? 0 : @positions.index(params[:position])
  .flex_container.justify-content-around

    %a#outing-footer-prev{:href => set_details_outing_path(@outing, position: @positions[current_position_index - 1])}
      %i#prev-chevron.bi-chevron-left
      Previous

    = link_to 'Done', outing_path(@outing), id: 'outing-footer-done'

    %a#outing-footer-next{:href => set_details_outing_path(@outing, position: @positions[current_position_index + 1])}
      Next
      %i#next-chevron.bi-chevron-right
